# Stage 1: Build the application using Maven
FROM docker.io/library/maven:3.8.4-openjdk-11-slim as builder

# Copy the project files into the container
COPY src /usr/src/app/src
COPY pom.xml /usr/src/app

# Set the working directory
WORKDIR /usr/src/app

# Build the application
RUN mvn clean package

# Stage 2: Run the application in a Tomcat container
FROM docker.io/library/tomcat:9-jdk11-openjdk-slim

# Copy the WAR file from the builder stage to the Tomcat webapps directory
COPY --from=builder /usr/src/app/target/zodiac.war /usr/local/tomcat/webapps/

# Expose the port Tomcat will run on
EXPOSE 8080

# Tomcat's default command will run automatically
